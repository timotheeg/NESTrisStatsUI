<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="tetris.css" />
<link rel="stylesheet" type="text/css" href="debug.css" />
<style>
html {
	overflow: hidden;
}
#stream_bg {
	background: black;
}

#playing_fields {
	position: absolute;
	left: 640px;
	top: 23px;
}

.box {
	width: 95px;
	height: 56px;
	text-align: center;
}

.box .header {
	font-size: 16px;
	padding-bottom: 0.5em;
}

.box .content,
.box .data {
	font-size: 24px;
	line-height: 30px;
}

.score {
	top: 76px;
	height: 60px;
	left: -107px;
	width: 168px;
}

.score .diff {
	text-align: center;
}

.next_piece {
	width: 104px;
	height: 60px;
	top: 6px;

	--offset: 177px;
	right: var(--offset)
}

.lines {
	left: -107px;
	top: 160px;
}

.level {
	left: -107px;
	top: 241px;
}

.board {
	border-image: url('./big_border.png');
	border-image-slice: 16 16 16 16 fill;
	border-image-width: 16px 16px;
	padding: 17px;
	width: 237px;
	height: 477px;
	top: 76px;

	--offset: 106px;
	right: var(--offset)
}

.tetris_rate {
	left: -107px;
	top: 588px;
}

.efficiency {
	left: -107px;
	top: 507px;
}

.tetris_rate .content {
	padding: 0 5px;
}

.running_trt {
	padding: 9px;
	width: 253px;
	height: 62px;
	top: 588px;

	--offset: 106px;
	right: var(--offset)
}

</style>
</head>
<body>

<textarea id="cur_frame"></textarea>
<textarea id="next_frame"></textarea>


<button id="goto_next_frame">Next Frame</button>
<button id="goto_next_frame_debug">Next Frame Debug</button>
<button id="play">Play</button>
<button id="stop">Stop</button>
<div id="skip"><input class="to"></body><button class="btn">Skip to</button></div>


<div id="stream_bg">
<div id="bg_pieces"></div>

<div id="playing_fields">
<div class="box board"></div>
<div class="box next_piece"></div>


<!-- Player 1 -->

<div class="box score">
	<div class="header">SCORE</div>
	<div class="content">000000</div>
</div>

<div class="box lines">
	<div class="header">LINES</div>
	<div class="content">000</div>
</div>

<div class="box level">
	<div class="header">LEVEL</div>
	<div class="content">000</div>
</div>

<div class="box tetris_rate">
	<div class="header">TRT</div>
	<div class="content">---</div>
</div>


<div class="box efficiency">
	<div class="header">EFF</div>
	<div class="content">---</div>
</div>


<div class="box running_trt"></div>

</div><!-- End Playing Fields -->
</div><!-- End Stream BG -->


<!-- Audio -->

<script src="sample_frames_11.js"></script>
<script src="constants.js"></script>
<script src="utils.js"></script>
<script src="bg.js"></script>
<script src="Player.js"></script>
<script >
const player = new Player(
	{
		score:       document.querySelector(`.score .content`),
		level:       document.querySelector(`.level .content`),
		lines:       document.querySelector(`.lines .content`),
		trt:         document.querySelector(`.tetris_rate .content`),
		eff:         document.querySelector(`.efficiency .content`),
		running_trt: document.querySelector(`.running_trt`),
		preview:     document.querySelector(`.next_piece`),
		field:       document.querySelector(`.board`)
	},
	{
		format_score: 0,
		tetris_sound: 0,
	}
);

const API = {
	frame(player_num, data) {
		player.setFrame(data);
	}
}

const socket = new WebSocket('ws://127.0.0.1:4003');

socket.addEventListener('message', (frame => {
	try{
		const [method, ...args] = JSON.parse(frame.data); // expect array of format [api_method_name, arg1, arg2, ...]

		API[method].apply(API, args);
	}
	catch(e) {
		console.error(e);
	}
}));

function onFrame(frame, debug) {
	API.frame(1, frame, debug);
}
</script>

<script src="sample_frames_11.js"></script>
<script src="debug.js"></script>


</body>
<html>